@use "../variables" as *;

@mixin reset-input {
  // Reboot based on normalize.css and sanitize.css

  // 1. Change the font styles in all browsers
  // 2. Remove the margin in Firefox and Safari
  input,
  optgroup,
  select,
  textarea {
    margin: 0; // 2
    font-size: 1rem; // 1
    line-height: var(--#{$prefix}-line-height-base); // 1
    font-family: inherit; // 1
    letter-spacing: inherit; // 2
  }

  // Show the overflow in IE.
  input {
    overflow: visible;
  }

  // Remove the inheritance of text transform in Edge, Firefox, and IE
  select {
    text-transform: none;
  }

  // 1. Correct the text wrapping in Edge and IE
  // 2. Correct the color inheritance from `fieldset` elements in IE
  // 3. Remove the padding so developers are not caught out when they zero out
  // `fieldset` elements in all browsers
  legend {
    max-width: 100%; // 1
    padding: 0; // 3
    color: inherit; // 2
    white-space: normal; // 1
  }

  // 1. Remove the default vertical scrollbar in IE
  textarea {
    overflow: auto; // 1
  }

  // Remove the padding in IE 10
  [type="checkbox"],
  [type="radio"] {
    padding: 0;
  }

  // Correct the cursor style of increment and decrement buttons in Safari
  ::-webkit-inner-spin-button,
  ::-webkit-outer-spin-button {
    height: auto;
  }

  // 1. Correct the odd appearance in Chrome and Safari
  // 2. Correct the outline style in Safari
  [type="search"] {
    -webkit-appearance: textfield; // 1
    outline-offset: -2px; // 2
  }

  // Remove the inner padding in Chrome and Safari on macOS
  [type="search"]::-webkit-search-decoration {
    -webkit-appearance: none;
  }

  // 1. Correct the inability to style clickable types in iOS and Safari
  // 2. Change font properties to `inherit` in Safari
  ::-webkit-file-upload-button {
    -webkit-appearance: button; // 1
    font: inherit; // 2
  }

  // Remove the inner border and padding of focus outlines in Firefox
  ::-moz-focus-inner {
    padding: 0;
    border-style: none;
  }

  //  Remove the focus outline in Firefox
  :-moz-focusring {
    outline: none;
  }

  // Remove the additional :invalid styles in Firefox
  :-moz-ui-invalid {
    box-shadow: none;
  }

  // Change the inconsistent appearance in IE (opinionated)
  ::-ms-expand {
    display: none;
  }

  // Remove the border and padding in all browsers (opinionated)
  [type="file"],
  [type="range"] {
    padding: 0;
    border-width: 0;
  }
}

%input {
  --height: var(--#{$prefix}-input-height);
  --padding: 0 var(--#{$prefix}-spacing);
  --line-height: var(--#{$prefix}-line-height-base);
  --border-radius: var(--#{$prefix}-border-radius);
  --border-color: var(--#{$prefix}-outline-variant);
  --font-size: var(--#{$prefix}-font-size-input);
  --background: var(--#{$prefix}-surface-container-variant);
  --color: var(--#{$prefix}-on-surface);
  --placeholder-color: var(--#{$prefix}-on-surface-variant);
  --box-shadow: none;
  --transition: var(--#{$prefix}-transition);

  display: inline-flex;
  width: 100%;
  padding: var(--padding);
  border: 1px solid var(--border-color);
  border-radius: var(--border-radius);
  font-size: var(--font-size);
  height: var(--height);
  line-height: var(--line-height);
  color: var(--color);
  background-color: var(--background);
  box-shadow: var(--box-shadow);
  transition: background-color var(--transition),
              border-color var(--transition),
              color var(--transition),
              box-shadow var(--transition);
  outline: none !important;
  background-repeat: no-repeat;
  background-size: $btn-icon-size;
  background-position: right var(--#{$prefix}-spacing) top calc((var(--#{$prefix}-input-height) - $btn-icon-size) / 2);

  &:disabled {
    --background: var(--#{$prefix}-surface-container);
    --color: var(--#{$prefix}-on-surface-variant);

    &::placeholder {
      --color: var(--#{$prefix}-on-surface-variant);
    }
  }

  &:is([type="date"], [type="datetime-local"], [type="month"], [type="time"], [type="week"]) {
    position: relative;

    &::-webkit-calendar-picker-indicator {
      position: absolute;
      right: var(--#{$prefix}-spacing);
      opacity: .5;
    }
  }

  &:focus {
    --box-shadow: 0 0 0 1px var(--#{$prefix}-primary) inset;
    --border-color: var(--#{$prefix}-primary);
  }
}

@mixin input {
  input:not(:where([type="checkbox"], [type="radio"], [type="range"], [type="file"], [type="submit"])),
  textarea,
  select {
    @extend %input;
  }

  textarea {
    --height: calc(var(--#{$prefix}-input-height) * 2) !important;

    padding-top: var(--#{$prefix}-spacing) !important;
  }

  :where(input, textarea)::placeholder {
    color: var(--placeholder-color);
  }
}

@mixin input-other {
  input[type="search"] {
    --border-radius: 999px !important;

    background-image: var(--#{$prefix}-search-icon);
    background-position: left var(--#{$prefix}-spacing) center !important;
    padding-left: calc(var(--#{$prefix}-spacing) * 3) !important;
  }

  input[type="color"] {
    --padding: calc(var(--#{$prefix}-spacing) / 2) var(--#{$prefix}-spacing) !important;
  }
}

@mixin input-states {
  :is(input, textarea, select) {
    &[aria-invalid="true"] {
      --border-color: var(--#{$prefix}-error);

      background-image: var(--#{$prefix}-invalid-icon);

      &:focus {
        --box-shadow: 0 0 0 1px var(--#{$prefix}-error) inset;
        --border-color: var(--#{$prefix}-error);
      }
    }

    &[aria-invalid="false"] {
      --border-color: var(--#{$prefix}-success);

      background-image: var(--#{$prefix}-valid-icon);

      &:focus {
        --box-shadow: 0 0 0 1px var(--#{$prefix}-success) inset;
        --border-color: var(--#{$prefix}-success);
      }
    }
  }
}

@mixin input-autofill {
  :is(input, textarea, select):is(:autofill, :-webkit-autofill) {
    box-shadow: 0 0 0 1000px var(--background) inset !important;
    -webkit-text-fill-color: var(--color) !important;
  }
}

@if $enable-forms {
  @include reset-input;
  @include input;
  @include input-other;
  @include input-states;

  @if $enable-autofill-fix {
    @include input-autofill;
  }
}
